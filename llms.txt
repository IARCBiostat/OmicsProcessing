# OmicsProcessing

Pre-analysis processing for metabolomics and proteomics: missingness
filtering, outlier handling, imputation, transformation, matched
case-control handling, batch/plate correction, and SERRF-based
normalisation across batches or strata.

## Choose your workflow

### Semi-automated pipeline (`process_data()`)

- End-to-end wrapper that can filter on missingness, impute, transform,
  remove outliers (PCA + LOF), handle matched case-control designs,
  correct for plate/batch effects, and centre/scale.
- Takes three data frames (feature data, feature metadata, sample
  metadata) and returns processed data plus exclusion IDs and PCA/LOF
  plots.
- Full walk-through: [Semi-automated
  pipeline](https://iarcbiostat.github.io/OmicsProcessing/articles/process_data.md).

### Modular workflow (build your own)

- Compose individual steps to suit your study design. Typical sequence:
  - Filter by missingness with
    [`filter_by_missingness()`](https://iarcbiostat.github.io/OmicsProcessing/reference/filter_by_missingness.md)
    ([vignette](https://iarcbiostat.github.io/OmicsProcessing/articles/data-filtering.md))
  - Detect outlier samples with
    [`remove_outliers()`](https://iarcbiostat.github.io/OmicsProcessing/reference/remove_outliers.md)
    ([vignette](https://iarcbiostat.github.io/OmicsProcessing/articles/outlier-removal.md))
  - Impute with RF, LCMD, or both via
    [`hybrid_imputation()`](https://iarcbiostat.github.io/OmicsProcessing/reference/hybrid_imputation.md)
    ([vignette](https://iarcbiostat.github.io/OmicsProcessing/articles/hybrid-imputation.md))
  - Normalise with SERRF using
    [`normalise_SERRF()`](https://iarcbiostat.github.io/OmicsProcessing/reference/normalise_SERRF.md)
    ([vignette](https://iarcbiostat.github.io/OmicsProcessing/articles/serrf-normalisation.md))
  - Cluster features by RT or correlations using
    [`cluster_features_by_retention_time()`](https://iarcbiostat.github.io/OmicsProcessing/reference/cluster_features_by_retention_time.md)
    ([vignette](https://iarcbiostat.github.io/OmicsProcessing/articles/feature-clustering.md))

## Quick start

``` r
# install.packages("remotes")
remotes::install_github("IARCBiostat/OmicsProcessing")
library(OmicsProcessing)
```

Run the semi-automated pipeline with three input tables:

``` r
processed <- process_data(
  data = data_features,
  data_meta_features = data_meta_features,
  data_meta_samples = data_meta_samples,
  col_samples = "ID_sample",
  exclusion_extreme_feature = TRUE,
  exclusion_extreme_sample = TRUE,
  imputation = TRUE,
  transformation = TRUE,
  outlier = TRUE,
  plate_correction = TRUE
)
```

Or stitch together a modular workflow:

``` r
# Load data
df <- readr::read_csv("path/to/data")

# Filter by missingness
df_filtered <- filter_by_missingness(
  df,
  row_thresh = 0.5,
  col_thresh = 0.5,
  target_cols = "@",
  is_qc = grepl("^sQC", df$sample_type),
  filter_order = "iterative"
)

# Detect outlier samples (PCA + LOF)
outliers <- remove_outliers(
  df_filtered,
  target_cols = "@",
  is_qc = grepl("^sQC", df_filtered$sample_type),
  method = "pca-lof-overall",
  impute_method = "half-min-value",
  restore_missing_values = TRUE,
  return_ggplots = FALSE
)
df_clean <- outliers$df_filtered

# Log-transform features
df_clean <- df_clean %>%
  dplyr::mutate(dplyr::across(tidyselect::contains("@"), log1p))

# Impute missing values (RF + LCMD)
df_imputed <- hybrid_imputation(
  df_clean,
  target_cols = "@",
  method = "RF-LCMD",
  oobe_threshold = 0.1
)$hybrid_rf_lcmd

# SERRF normalisation
df_normalised <- normalise_SERRF(
  df_imputed,
  target_cols = "@",
  is_qc = grepl("^sQC", df_imputed$sample_type),
  strata_col = "batch"
)

# Cluster features by RT using correlations
clusters <- cluster_features_by_retention_time(
  df = df_normalised,
  target_cols = "@",
  rt_height = 0.07,
  method = "correlations",
  cut_height = 0.26,
  corr_thresh = 0.75
)
```

## Developers & Contributors

We welcome contributions to **OmicsProcessing**. Our priorities are
clean code and good documentation.

Please follow these guidelines: [Developers &
Contributors](https://iarcbiostat.github.io/OmicsProcessing/articles/developer-guidelines.md)

## Resources

- Data filtering vignette: [Filtering
  missingness](https://iarcbiostat.github.io/OmicsProcessing/articles/data-filtering.md)
- Outlier removal vignette: [PCA + LOF outlier
  detection](https://iarcbiostat.github.io/OmicsProcessing/articles/outlier-removal.md)
- Hybrid imputation vignette: [Random Forest +
  LCMD](https://iarcbiostat.github.io/OmicsProcessing/articles/hybrid-imputation.md)
- Function reference index: [All
  functions](https://iarcbiostat.github.io/OmicsProcessing/reference/index.md)
- Semi-automated pipeline details: [Semi-automated pipeline
  vignette](https://iarcbiostat.github.io/OmicsProcessing/articles/process_data.md)
- Log-transform features: [Log transformation
  (log1p)](https://iarcbiostat.github.io/OmicsProcessing/articles/log-transformation.md)
- SERRF batch correction: [Batch correction using
  SERRF](https://iarcbiostat.github.io/OmicsProcessing/articles/serrf-normalisation.md)
- Feature clustering: [Retention-time
  clustering](https://iarcbiostat.github.io/OmicsProcessing/articles/feature-clustering.md)
- Developers & contributors: [Developer
  guide](https://iarcbiostat.github.io/OmicsProcessing/articles/developer-guidelines.md)

# Package index

## All functions

- [`FUNnormalization_residualMixedModels()`](https://iarcbiostat.github.io/OmicsProcessing/reference/FUNnormalization_residualMixedModels.md)
  : Compute Residuals Using Mixed Models
- [`calculate_ICC()`](https://iarcbiostat.github.io/OmicsProcessing/reference/calculate_ICC.md)
  : Calculate Intraclass Correlation Coefficient (ICC)
- [`calculate_ICC_parallel()`](https://iarcbiostat.github.io/OmicsProcessing/reference/calculate_ICC_parallel.md)
  : Calculate Intraclass Correlation Coefficient (ICC) parallel
- [`check_dataframe_validity()`](https://iarcbiostat.github.io/OmicsProcessing/reference/check_dataframe_validity.md)
  : Validate a Data Frame for LCMD Imputation
- [`cluster_features_based_on_correlations()`](https://iarcbiostat.github.io/OmicsProcessing/reference/cluster_features_based_on_correlations.md)
  : Cluster feature groups based on correlations
- [`cluster_features_by_retention_time()`](https://iarcbiostat.github.io/OmicsProcessing/reference/cluster_features_by_retention_time.md)
  : Cluster features by retention time and summarise within clusters
- [`data_check()`](https://iarcbiostat.github.io/OmicsProcessing/reference/data_check.md)
  : check required columns
- [`data_features`](https://iarcbiostat.github.io/OmicsProcessing/reference/data_features.md)
  : Simulated Dataframe 1
- [`data_meta_features`](https://iarcbiostat.github.io/OmicsProcessing/reference/data_meta_features.md)
  : Simulated Dataframe 2
- [`data_meta_samples`](https://iarcbiostat.github.io/OmicsProcessing/reference/data_meta_samples.md)
  : Simulated Dataframe 3
- [`exclude_features()`](https://iarcbiostat.github.io/OmicsProcessing/reference/exclude_features.md)
  : Exclude features with X misingness
- [`exclude_samples()`](https://iarcbiostat.github.io/OmicsProcessing/reference/exclude_samples.md)
  : Exclude samples with X missingness
- [`filter_by_missingness()`](https://iarcbiostat.github.io/OmicsProcessing/reference/filter_by_missingness.md)
  : Filter a data.frame by missingness in rows and columns
- [`filter_case_control()`](https://iarcbiostat.github.io/OmicsProcessing/reference/filter_case_control.md)
  : Filter Samples Based on Case Control Criteria
- [`filter_function_args()`](https://iarcbiostat.github.io/OmicsProcessing/reference/filter_function_args.md)
  : Filter a list to match the formal arguments of a target function
- [`generate_labels()`](https://iarcbiostat.github.io/OmicsProcessing/reference/generate_labels.md)
  : generate labels
- [`get_features_representatives_based_on_scores()`](https://iarcbiostat.github.io/OmicsProcessing/reference/get_features_representatives_based_on_scores.md)
  : Select representative features per cluster using correlation
  threshold and scores
- [`hybrid_imputation()`](https://iarcbiostat.github.io/OmicsProcessing/reference/hybrid_imputation.md)
  : Hybrid Imputation: Random Forest + LCMD
- [`impute_data()`](https://iarcbiostat.github.io/OmicsProcessing/reference/impute_data.md)
  : Impute missing data in a data frame
- [`impute_with_half_min()`](https://iarcbiostat.github.io/OmicsProcessing/reference/impute_with_half_min.md)
  : Impute Missing Values with Half the Minimum
- [`normalise_SERRF()`](https://iarcbiostat.github.io/OmicsProcessing/reference/normalise_SERRF.md)
  : SERRF Normalization
- [`normalization_residualMixedModels()`](https://iarcbiostat.github.io/OmicsProcessing/reference/normalization_residualMixedModels.md)
  : Normalize feature Data Using Residual Mixed Models
- [`outlier_pca_lof()`](https://iarcbiostat.github.io/OmicsProcessing/reference/outlier_pca_lof.md)
  : PCA-Based Outlier Detection Using LOF
- [`parse_mass_rt()`](https://iarcbiostat.github.io/OmicsProcessing/reference/parse_mass_rt.md)
  : Parse mass/retention-time strings
- [`process_data()`](https://iarcbiostat.github.io/OmicsProcessing/reference/process_data.md)
  : Process feature data
- [`register_cluster()`](https://iarcbiostat.github.io/OmicsProcessing/reference/register_cluster.md)
  : Register a parallel cluster for parallel processing.
- [`remove_outliers()`](https://iarcbiostat.github.io/OmicsProcessing/reference/remove_outliers.md)
  : Remove outliers (optionally stratified) using PCA + LOF
- [`resolve_target_cols()`](https://iarcbiostat.github.io/OmicsProcessing/reference/resolve_target_cols.md)
  : Resolve Target Columns from Names or Regex
- [`run_lcmd_imputation()`](https://iarcbiostat.github.io/OmicsProcessing/reference/run_lcmd_imputation.md)
  : Run LCMD Imputation (Overall)
- [`run_rf_imputation()`](https://iarcbiostat.github.io/OmicsProcessing/reference/run_rf_imputation.md)
  : Run Random Forest Imputation with Optional Parallelization
- [`transform_data()`](https://iarcbiostat.github.io/OmicsProcessing/reference/transform_data.md)
  : Apply Data Transformation to Data Frame
- [`unregister_cluster()`](https://iarcbiostat.github.io/OmicsProcessing/reference/unregister_cluster.md)
  : Unregister a parallel cluster used for parallel processing.

# Articles

### All vignettes

- [Data filtering with
  filter_by_missingness()](https://iarcbiostat.github.io/OmicsProcessing/articles/data-filtering.md):
- [Developers &
  Contributors](https://iarcbiostat.github.io/OmicsProcessing/articles/developer-guidelines.md):
- [Feature clustering by retention
  time](https://iarcbiostat.github.io/OmicsProcessing/articles/feature-clustering.md):
- [Hybrid imputation with RF +
  LCMD](https://iarcbiostat.github.io/OmicsProcessing/articles/hybrid-imputation.md):
- [Log transformation with
  log1p()](https://iarcbiostat.github.io/OmicsProcessing/articles/log-transformation.md):
- [Outlier removal with
  remove_outliers()](https://iarcbiostat.github.io/OmicsProcessing/articles/outlier-removal.md):
- [Semi-automated pipeline with
  process_data()](https://iarcbiostat.github.io/OmicsProcessing/articles/process_data.md):
- [Batch correction using
  SERRF](https://iarcbiostat.github.io/OmicsProcessing/articles/serrf-normalisation.md):
