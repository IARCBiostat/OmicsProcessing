<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Cluster feature groups based on correlations — cluster_features_based_on_correlations • OmicsProcessing</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cluster feature groups based on correlations — cluster_features_based_on_correlations"><meta name="description" content="Given a list of pre-defined feature groups, construct a data set of
representative features by collapsing groups with high correlations into
synthetic variables."><meta property="og:description" content="Given a list of pre-defined feature groups, construct a data set of
representative features by collapsing groups with high correlations into
synthetic variables."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OmicsProcessing</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/data-filtering.html">Data filtering with filter_by_missingness()</a></li>
    <li><a class="dropdown-item" href="../articles/developer-guidelines.html">Developers &amp; Contributors</a></li>
    <li><a class="dropdown-item" href="../articles/feature-clustering.html">Feature clustering by retention time</a></li>
    <li><a class="dropdown-item" href="../articles/hybrid-imputation.html">Hybrid imputation with RF + LCMD</a></li>
    <li><a class="dropdown-item" href="../articles/log-transformation.html">Log transformation with log1p()</a></li>
    <li><a class="dropdown-item" href="../articles/outlier-removal.html">Outlier removal with remove_outliers()</a></li>
    <li><a class="dropdown-item" href="../articles/process_data.html">Semi-automated pipeline with process_data()</a></li>
    <li><a class="dropdown-item" href="../articles/serrf-normalisation.html">Batch correction using SERRF</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Cluster feature groups based on correlations</h1>

      <div class="d-none name"><code>cluster_features_based_on_correlations.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Given a list of pre-defined feature groups, construct a data set of
representative features by collapsing groups with high correlations into
synthetic variables.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cluster_features_based_on_correlations</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="va">cluster_feature_list</span>,</span>
<span>  <span class="va">cut_height</span>,</span>
<span>  <span class="va">corr_thresh</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>A tibble or data.frame containing the feature columns (and
possibly other variables not used here). All variables referenced in
<code>cluster_feature_list</code> must be columns of <code>df</code>.</p></dd>


<dt id="arg-cluster-feature-list">cluster_feature_list<a class="anchor" aria-label="anchor" href="#arg-cluster-feature-list"></a></dt>
<dd><p>A list where each element is a character vector
giving the names of the features that belong to one initial cluster.
Feature names are typically of the form <code>"RT@mass"</code>, where
<code>RT</code> and <code>mass</code> are real numbers corresponding to retention
time and mass, but any valid column names are accepted.</p></dd>


<dt id="arg-cut-height">cut_height<a class="anchor" aria-label="anchor" href="#arg-cut-height"></a></dt>
<dd><p>Numeric. Cut-off height for the correlation-based
clustering within groups of size three or more (as implemented in
<span class="pkg">ClustOfVar</span>). A suggested value is <code>0.26</code>, which corresponds
roughly to a pairwise correlation of about <code>0.75</code>. You can use a
dedicated helper (e.g. <code>simul_eval_link_hhh_corr</code>) to explore the
correspondence between pairwise correlations and the tree height returned
by <code><a href="https://rdrr.io/pkg/ClustOfVar/man/hclustvar.html" class="external-link">ClustOfVar::hclustvar()</a></code>.</p></dd>


<dt id="arg-corr-thresh">corr_thresh<a class="anchor" aria-label="anchor" href="#arg-corr-thresh"></a></dt>
<dd><p>Numeric. Cut-off for the absolute pairwise correlation
used when the number of features in a group is exactly two. If the
absolute correlation between the two features is at least
<code>corr_thresh</code>, they are replaced by a single synthetic feature
(first principal component); otherwise both original features are kept.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with the following components:</p><dl><dt>clustered_df</dt>
<dd><p>A tibble with one row per observation and one column
per final representative feature. For clusters of size one, the column
is the original feature. For size two with correlation above
<code>corr_thresh</code>, the column is the first principal component of
the two features. For larger clusters, columns are synthetic variables
returned by <span class="pkg">ClustOfVar</span>, oriented to have a positive correlation
with the first feature of the corresponding sub-cluster.</p></dd>

<dt>representatives_map</dt>
<dd><p>A named list mapping each synthetic feature
(columns whose names start with <code>"SynthFeat@"</code>) to the character
vector of original feature names that it summarises. Original features
that are kept as is do not appear in this map.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For groups of size one, the original feature is kept as is. For groups of
size two, the decision is based on their pairwise correlation. For larger
groups, clustering is based on the decrease in homogeneity as in the
<span class="pkg">ClustOfVar</span> package. The homogeneity of a cluster is the squared
correlation (for quantitative variables) between the variables and the
cluster centre (the first principal component).</p>
<p>This function is typically used after a pre-grouping step (for example,
after retention-time-based grouping). Each element of
<code>cluster_feature_list</code> corresponds to one such pre-defined group and
may contain one, two, or more feature names; all cases are handled.</p>
<p>For groups of size three or more, a hierarchical clustering tree is first
obtained using <code><a href="https://rdrr.io/pkg/ClustOfVar/man/hclustvar.html" class="external-link">ClustOfVar::hclustvar()</a></code>. The tree is then cut at
a data-driven position derived from <code>cut_height</code>, and
<code><a href="https://rdrr.io/pkg/ClustOfVar/man/cutreevar.html" class="external-link">ClustOfVar::cutreevar()</a></code> is used to obtain synthetic scores for the
resulting sub-clusters. Each score is multiplied by \(+1\) or \(-1\)
so that it has a positive correlation with the first feature in its
sub-cluster.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_tbl</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  `100@150` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  `100@151` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  `101@200` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pre-defined feature groups (e.g. after a retention-time grouping step)</span></span></span>
<span class="r-in"><span><span class="va">cluster_feature_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"100@150"</span>, <span class="st">"100@151"</span><span class="op">)</span>, <span class="co"># group of size 2</span></span></span>
<span class="r-in"><span>  <span class="st">"101@200"</span> <span class="co"># group of size 1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">cluster_features_based_on_correlations</span><span class="op">(</span></span></span>
<span class="r-in"><span>  df <span class="op">=</span> <span class="va">data_tbl</span>,</span></span>
<span class="r-in"><span>  cluster_feature_list <span class="op">=</span> <span class="va">cluster_feature_list</span>,</span></span>
<span class="r-in"><span>  cut_height <span class="op">=</span> <span class="fl">0.26</span>,</span></span>
<span class="r-in"><span>  corr_thresh <span class="op">=</span> <span class="fl">0.75</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">clustered_df</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        100@150     100@151     101@200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  -0.56047565 -1.06782371 -0.69470698</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  -0.23017749 -0.21797491 -0.20791728</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   1.55870831 -1.02600445 -1.26539635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   0.07050839 -0.72889123  2.16895597</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   0.12928774 -0.62503927  1.20796200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   1.71506499 -1.68669331 -1.12310858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   0.46091621  0.83778704 -0.40288484</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  -1.26506123  0.15337312 -0.46665535</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  -0.68685285 -1.13813694  0.77996512</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 -0.44566197  1.25381492 -0.08336907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11  1.22408180  0.42646422  0.25331851</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  0.35981383 -0.29507148 -0.02854676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  0.40077145  0.89512566 -0.04287046</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14  0.11068272  0.87813349  1.36860228</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15 -0.55584113  0.82158108 -0.22577099</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16  1.78691314  0.68864025  1.51647060</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17  0.49785048  0.55391765 -1.54875280</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18 -1.96661716 -0.06191171  0.58461375</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19  0.70135590 -0.30596266  0.12385424</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20 -0.47279141 -0.38047100  0.21594157</span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">representatives_map</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> list()</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vivian Viallon, Lee Matthew, Ali Farnudi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

