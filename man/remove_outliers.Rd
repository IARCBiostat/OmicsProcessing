% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/remove_outliers.R
\name{remove_outliers}
\alias{remove_outliers}
\title{Remove outliers (optionally stratified) using PCA + LOF}
\usage{
remove_outliers(
  df,
  target_cols = NULL,
  is_qc = NULL,
  method = c("pca-lof-overall"),
  impute_method = c(NULL, "half-min-value"),
  restore_missing_values = TRUE,
  return_ggplots = FALSE,
  strata = NULL
)
}
\arguments{
\item{df}{A data.frame with features in columns and samples in rows.}

\item{target_cols}{Character vector of column names (or tidyselect helpers if supported by \code{resolve_target_cols()}).
If \code{NULL}, uses \code{resolve_target_cols(df, NULL)} to infer targets.}

\item{is_qc}{Logical vector (length \code{nrow(df)}) marking QC rows to exclude from detection. Defaults to all \code{FALSE}.}

\item{method}{Character; currently supports \code{"pca-lof-overall"} (default behavior).}

\item{impute_method}{\code{NULL} or \code{"half-min-value"}. If set, imputation is applied \strong{within each stratum} on \code{target_cols}.}

\item{restore_missing_values}{Logical; if \code{TRUE}, original \code{NA}s in \code{target_cols} are restored after filtering.}

\item{return_ggplots}{Logical; if \code{TRUE}, returns a named list of ggplots per stratum.}

\item{strata}{\code{NULL} (default), a single column name in \code{df}, or an external vector of length \code{nrow(df)}.
When provided, outlier detection is run independently within each stratum (QC rows always excluded within the stratum).}
}
\value{
A list with:
\describe{
\item{df_filtered}{\code{df} with detected outlier rows removed (QC rows always retained).}
\item{excluded_ids}{Character vector of row names removed (union across strata).}
\item{plot_samples_outlier}{If \code{return_ggplots = TRUE}, a named list of ggplot objects per stratum; otherwise \code{NULL}.}
}
}
\description{
Wrapper around \code{outlier_pca_lof()} with conveniences:
\itemize{
\item Select a subset of columns (\code{target_cols})
\item Exclude QC rows from outlier detection
\item Temporarily impute missing values (half of min) for detection
\item \strong{New:} apply detection independently within strata (\code{strata})
}
}
\examples{
# No stratification (current behavior)
# remove_outliers(df, target_cols = c("f1","f2"))

# Stratify by a column
# remove_outliers(df, target_cols = c("f1","f2"), strata = "batch")

# Stratify by an external vector
# grp <- ifelse(df$batch \%in\% c("A","B"), "AB", "C")
# remove_outliers(df, target_cols = c("f1","f2"), strata = grp)

}
